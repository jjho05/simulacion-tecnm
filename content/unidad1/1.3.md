# 1.3 Metodología de la simulación

La metodología de simulación es un proceso sistemático y estructurado que guía el desarrollo de un estudio de simulación desde su concepción hasta la implementación de resultados. Seguir una metodología rigurosa es fundamental para garantizar la validez y utilidad del modelo.

---

## Visión General de la Metodología

La simulación no es simplemente "programar un modelo y ejecutarlo". Es un proceso científico que requiere planificación, análisis, validación y documentación cuidadosa.

### Principios Fundamentales

1. **Orientación a objetivos:** Todo estudio debe tener objetivos claros y medibles
2. **Iteración:** El proceso es cíclico, no lineal
3. **Validación continua:** Verificar y validar en cada etapa
4. **Documentación:** Registrar decisiones y supuestos
5. **Comunicación:** Involucrar a stakeholders en todo el proceso

---

## Etapas de la Metodología de Simulación

### Etapa 1: Definición del Problema y Objetivos

**Propósito:** Establecer claramente qué se desea lograr con el estudio de simulación.

**Actividades clave:**

1. **Identificar el problema:**
   - ¿Qué no está funcionando bien?
   - ¿Qué decisión se necesita tomar?
   - ¿Qué oportunidad de mejora existe?

2. **Definir objetivos específicos:**
   - Deben ser SMART (Específicos, Medibles, Alcanzables, Relevantes, Temporales)
   - Ejemplo: "Reducir el tiempo promedio de espera de clientes de 15 a menos de 10 minutos en 3 meses"

3. **Identificar stakeholders:**
   - Quién tomará decisiones basadas en el estudio
   - Quién proporcionará datos
   - Quién será afectado por los cambios

**Ejemplo práctico:**

**Problema:** Un hospital tiene quejas por largos tiempos de espera en urgencias

**Objetivos:**
- Reducir tiempo promedio de espera a < 30 minutos
- Mantener utilización de médicos entre 70-85%
- Identificar configuración óptima de personal por turno

**Stakeholders:**
- Director del hospital (toma decisiones)
- Jefe de urgencias (proporciona datos)
- Personal médico (afectado por cambios)
- Pacientes (beneficiarios)

**Errores comunes:**
❌ Objetivo vago: "Mejorar el hospital"
✅ Objetivo claro: "Reducir tiempo de espera en urgencias de 45 a 30 minutos"

---

### Etapa 2: Formulación del Modelo Conceptual

**Propósito:** Crear una representación abstracta del sistema antes de programar.

**Actividades clave:**

1. **Definir fronteras del sistema:**
   - ¿Qué está dentro del modelo?
   - ¿Qué está fuera?
   - ¿Dónde comienza y termina el análisis?

2. **Identificar componentes:**
   - Entidades (qué fluye)
   - Recursos (qué se requiere)
   - Procesos (qué sucede)
   - Variables de estado (qué se mide)

3. **Crear diagramas de flujo:**
   - Mapear el proceso completo
   - Identificar puntos de decisión
   - Documentar rutas alternativas

4. **Establecer supuestos:**
   - Simplificaciones necesarias
   - Comportamientos asumidos
   - Restricciones del modelo

**Herramientas útiles:**
- Diagramas de flujo
- Diagramas de bloques
- Mapas de proceso
- Diagramas IDEF0

**Ejemplo de modelo conceptual - Banco:**

```
ENTRADAS:
- Clientes (tasa de llegada variable por hora)

PROCESOS:
1. Llegada → Cola única
2. Asignación a caja disponible
3. Servicio (tiempo variable según tipo de transacción)
4. Salida del sistema

RECURSOS:
- 3 cajas de atención
- 3 cajeros

MÉTRICAS:
- Tiempo promedio en cola
- Tiempo promedio en sistema
- Utilización de cajas
- Longitud máxima de cola
```

**Validación conceptual:**
- Revisar con expertos del dominio
- Confirmar que captura la esencia del problema
- Verificar que los supuestos son razonables

---

### Etapa 3: Recolección y Análisis de Datos

**Propósito:** Obtener datos reales para alimentar el modelo.

**Tipos de datos necesarios:**

1. **Datos de entrada:**
   - Tasas de llegada
   - Tiempos de servicio
   - Tasas de falla
   - Demandas

2. **Datos de configuración:**
   - Número de recursos
   - Capacidades
   - Horarios de operación

3. **Datos de validación:**
   - Métricas históricas del sistema real
   - Datos para comparar con resultados del modelo

**Métodos de recolección:**

| Método | Ventajas | Desventajas | Cuándo usar |
|--------|----------|-------------|-------------|
| Observación directa | Preciso, contextual | Costoso en tiempo | Sistemas accesibles |
| Registros históricos | Abundante, económico | Puede estar incompleto | Sistemas con buenos registros |
| Entrevistas | Captura conocimiento experto | Subjetivo | Procesos complejos |
| Sensores/IoT | Automático, continuo | Requiere infraestructura | Sistemas modernos |

**Análisis estadístico de datos:**

1. **Estadística descriptiva:**
   - Media, mediana, moda
   - Desviación estándar
   - Mínimo, máximo, rangos

2. **Identificación de distribuciones:**
   - Ajuste de distribuciones teóricas
   - Pruebas de bondad de ajuste (Chi-cuadrada, K-S)
   - Selección de mejor distribución

3. **Análisis de correlaciones:**
   - ¿Las variables están relacionadas?
   - ¿Hay patrones temporales?

**Ejemplo de análisis de datos:**

```python
import numpy as np
import scipy.stats as stats
import matplotlib.pyplot as plt

# Datos de tiempos de servicio (minutos)
datos = [3.2, 4.1, 2.8, 5.3, 3.9, 4.5, 3.1, 4.8, 3.7, 4.2]

# Estadística descriptiva
media = np.mean(datos)
desv_std = np.std(datos, ddof=1)
print(f"Media: {media:.2f} min")
print(f"Desviación estándar: {desv_std:.2f} min")

# Probar ajuste a distribución normal
stat, p_value = stats.shapiro(datos)
print(f"Prueba de normalidad: p-value = {p_value:.4f}")

if p_value > 0.05:
    print("Los datos parecen seguir distribución normal")
else:
    print("Los datos NO siguen distribución normal")

# Visualización
plt.hist(datos, bins=5, density=True, alpha=0.7)
plt.xlabel('Tiempo de servicio (min)')
plt.ylabel('Frecuencia')
plt.title('Distribución de Tiempos de Servicio')
plt.show()
```

**Calidad de datos:**
- **Suficiencia:** ¿Hay suficientes datos? (mínimo 30-50 observaciones)
- **Representatividad:** ¿Los datos capturan la variabilidad real?
- **Actualidad:** ¿Los datos son recientes y relevantes?

---

### Etapa 4: Implementación del Modelo Computacional

**Propósito:** Traducir el modelo conceptual a código ejecutable.

**Decisiones clave:**

1. **Selección de herramienta:**
   - Lenguaje de programación (Python, Java, C++)
   - Software de simulación (Arena, SimPy, AnyLogic)
   - Criterios: costo, curva de aprendizaje, flexibilidad

2. **Paradigma de simulación:**
   - Avance de tiempo (fijo vs. eventos)
   - Estructura de datos
   - Manejo de aleatoriedad

**Buenas prácticas de programación:**

✅ **Código modular:**
```python
# Separar lógica en funciones
def generar_tiempo_llegada():
    return random.expovariate(1/5)  # Media de 5 minutos

def generar_tiempo_servicio():
    return random.normalvariate(4, 1)  # Media 4, desv 1

def procesar_cliente(cliente, servidor):
    # Lógica de procesamiento
    pass
```

✅ **Documentación:**
```python
def simular_banco(num_cajas, tiempo_simulacion, semilla=42):
    """
    Simula operación de un banco.
    
    Args:
        num_cajas (int): Número de cajas de atención
        tiempo_simulacion (float): Duración de la simulación en minutos
        semilla (int): Semilla para reproducibilidad
    
    Returns:
        dict: Estadísticas de la simulación
    """
    # Implementación...
```

✅ **Parámetros configurables:**
```python
# Archivo de configuración
CONFIG = {
    'num_cajas': 3,
    'tasa_llegada': 12,  # clientes/hora
    'tiempo_servicio_medio': 4,  # minutos
    'tiempo_simulacion': 480  # 8 horas
}
```

**Ejemplo completo - Simulación simple:**

```python
import simpy
import random

class Banco:
    def __init__(self, env, num_cajas):
        self.env = env
        self.cajas = simpy.Resource(env, num_cajas)
        self.tiempos_espera = []
    
    def atender_cliente(self, cliente_id):
        tiempo_llegada = self.env.now
        
        with self.cajas.request() as req:
            yield req
            
            tiempo_espera = self.env.now - tiempo_llegada
            self.tiempos_espera.append(tiempo_espera)
            
            print(f"Cliente {cliente_id} esperó {tiempo_espera:.1f} min")
            
            # Tiempo de servicio
            tiempo_servicio = random.normalvariate(4, 1)
            yield self.env.timeout(tiempo_servicio)

def generador_clientes(env, banco):
    cliente_id = 0
    while True:
        yield env.timeout(random.expovariate(1/5))  # Llegada cada 5 min promedio
        cliente_id += 1
        env.process(banco.atender_cliente(cliente_id))

# Ejecutar simulación
env = simpy.Environment()
banco = Banco(env, num_cajas=3)
env.process(generador_clientes(env, banco))
env.run(until=480)  # 8 horas

# Resultados
print(f"\nTiempo promedio de espera: {sum(banco.tiempos_espera)/len(banco.tiempos_espera):.2f} min")
print(f"Clientes atendidos: {len(banco.tiempos_espera)}")
```

---

### Etapa 5: Verificación del Modelo

**Propósito:** Asegurar que el código implementa correctamente el modelo conceptual.

**Técnicas de verificación:**

1. **Revisión de código:**
   - Peer review
   - Walkthrough con expertos
   - Inspección de lógica

2. **Pruebas unitarias:**
```python
def test_generador_tiempos():
    random.seed(42)
    tiempos = [generar_tiempo_servicio() for _ in range(1000)]
    media = sum(tiempos) / len(tiempos)
    assert 3.5 < media < 4.5, "Media fuera de rango esperado"
```

3. **Trazas de eventos:**
   - Imprimir cada evento que ocurre
   - Verificar secuencia lógica
   - Detectar comportamientos anómalos

4. **Casos extremos:**
   - ¿Qué pasa con 0 clientes?
   - ¿Qué pasa con demanda infinita?
   - ¿Funciona con 1 servidor? ¿Con 100?

5. **Animación:**
   - Visualizar el modelo en ejecución
   - Identificar problemas visualmente

**Checklist de verificación:**

- [ ] ¿Las entidades se crean correctamente?
- [ ] ¿Los recursos se asignan y liberan apropiadamente?
- [ ] ¿Los tiempos avanzan correctamente?
- [ ] ¿Las estadísticas se calculan bien?
- [ ] ¿El modelo termina correctamente?
- [ ] ¿Los resultados son reproducibles (con misma semilla)?

---

### Etapa 6: Validación del Modelo

**Propósito:** Asegurar que el modelo representa adecuadamente el sistema real.

**Tipos de validación:**

1. **Validación de cara (Face Validity):**
   - Presentar modelo a expertos
   - ¿El comportamiento "se ve" correcto?
   - ¿Los supuestos son razonables?

2. **Validación estadística:**
   - Comparar salidas del modelo con datos reales
   - Pruebas t, pruebas F, pruebas K-S
   - Intervalos de confianza

3. **Validación de sensibilidad:**
   - Variar parámetros de entrada
   - Verificar que salidas cambian razonablemente
   - Identificar parámetros críticos

**Ejemplo de validación estadística:**

```python
import scipy.stats as stats

# Datos reales del sistema
tiempos_reales = [8.2, 9.1, 7.5, 8.8, 9.3, 8.1, 7.9, 8.5]

# Datos del modelo (múltiples réplicas)
tiempos_simulados = [8.5, 8.9, 8.1, 8.7, 8.3, 8.6, 8.4, 8.2]

# Prueba t para comparar medias
t_stat, p_value = stats.ttest_ind(tiempos_reales, tiempos_simulados)

print(f"Estadístico t: {t_stat:.3f}")
print(f"P-value: {p_value:.3f}")

if p_value > 0.05:
    print("✅ No hay diferencia significativa - Modelo VÁLIDO")
else:
    print("❌ Hay diferencia significativa - Revisar modelo")
```

**Criterios de aceptación:**
- Diferencia < 10% en métricas clave
- Pruebas estadísticas no rechazan hipótesis de igualdad
- Expertos confirman que el comportamiento es realista

---

### Etapa 7: Diseño de Experimentos

**Propósito:** Planificar qué escenarios evaluar para responder las preguntas del estudio.

**Elementos del diseño:**

1. **Factores a variar:**
   - ¿Qué parámetros cambiar?
   - ¿En qué rangos?
   - Ejemplo: Número de cajas (2, 3, 4, 5)

2. **Niveles de cada factor:**
   - Valores específicos a probar
   - Considerar valores actuales y propuestos

3. **Combinaciones de factores:**
   - Diseño factorial completo
   - Diseño factorial fraccionado
   - Diseño de superficie de respuesta

4. **Número de réplicas:**
   - Mínimo 30 para intervalos de confianza confiables
   - Más réplicas = mayor precisión

5. **Longitud de simulación:**
   - ¿Cuánto tiempo simular?
   - Considerar período de calentamiento

**Ejemplo de diseño de experimentos:**

| Escenario | Cajas | Tasa Llegada | Réplicas | Objetivo |
|-----------|-------|--------------|----------|----------|
| Base | 3 | 12/hora | 50 | Situación actual |
| A | 4 | 12/hora | 50 | Agregar 1 caja |
| B | 3 | 15/hora | 50 | Aumento demanda |
| C | 4 | 15/hora | 50 | Combinado |

**Código para experimentos:**

```python
import pandas as pd

def ejecutar_experimento(num_cajas, tasa_llegada, num_replicas=30):
    resultados = []
    
    for replica in range(num_replicas):
        env = simpy.Environment()
        banco = Banco(env, num_cajas)
        env.process(generador_clientes(env, banco, tasa_llegada))
        env.run(until=480)
        
        tiempo_promedio = sum(banco.tiempos_espera) / len(banco.tiempos_espera)
        resultados.append(tiempo_promedio)
    
    return {
        'media': np.mean(resultados),
        'desv_std': np.std(resultados),
        'ic_95': 1.96 * np.std(resultados) / np.sqrt(num_replicas)
    }

# Ejecutar todos los escenarios
escenarios = [
    {'nombre': 'Base', 'cajas': 3, 'tasa': 12},
    {'nombre': 'A', 'cajas': 4, 'tasa': 12},
    {'nombre': 'B', 'cajas': 3, 'tasa': 15},
    {'nombre': 'C', 'cajas': 4, 'tasa': 15}
]

for esc in escenarios:
    resultado = ejecutar_experimento(esc['cajas'], esc['tasa'])
    print(f"{esc['nombre']}: {resultado['media']:.2f} ± {resultado['ic_95']:.2f} min")
```

---

### Etapa 8: Ejecución y Análisis de Resultados

**Propósito:** Correr el modelo y extraer conclusiones.

**Actividades:**

1. **Ejecutar simulaciones:**
   - Todas las réplicas de todos los escenarios
   - Registrar semillas para reproducibilidad
   - Monitorear progreso

2. **Análisis estadístico:**
   - Calcular medias e intervalos de confianza
   - Comparar escenarios (ANOVA, pruebas t)
   - Identificar diferencias significativas

3. **Visualización:**
   - Gráficos de barras para comparaciones
   - Box plots para distribuciones
   - Gráficos de series de tiempo

**Ejemplo de análisis:**

```python
import matplotlib.pyplot as plt

# Resultados de diferentes escenarios
escenarios = ['Base', 'A', 'B', 'C']
tiempos = [8.5, 6.2, 12.3, 8.9]
errores = [0.5, 0.4, 0.8, 0.6]

plt.figure(figsize=(10, 6))
plt.bar(escenarios, tiempos, yerr=errores, capsize=5)
plt.axhline(y=10, color='r', linestyle='--', label='Meta (10 min)')
plt.xlabel('Escenario')
plt.ylabel('Tiempo promedio de espera (min)')
plt.title('Comparación de Escenarios')
plt.legend()
plt.grid(axis='y', alpha=0.3)
plt.show()
```

4. **Interpretación:**
   - ¿Qué escenario cumple los objetivos?
   - ¿Cuál es el trade-off costo-beneficio?
   - ¿Hay efectos inesperados?

---

### Etapa 9: Documentación y Presentación

**Propósito:** Comunicar resultados a stakeholders.

**Elementos del reporte:**

1. **Resumen ejecutivo:**
   - Problema, objetivos, hallazgos clave
   - Recomendaciones
   - 1-2 páginas máximo

2. **Descripción del sistema:**
   - Diagrama del modelo conceptual
   - Supuestos y limitaciones

3. **Datos y distribuciones:**
   - Fuentes de datos
   - Distribuciones ajustadas
   - Pruebas de bondad de ajuste

4. **Verificación y validación:**
   - Métodos utilizados
   - Resultados de pruebas

5. **Resultados:**
   - Tablas y gráficos
   - Intervalos de confianza
   - Comparaciones estadísticas

6. **Recomendaciones:**
   - Escenario óptimo
   - Plan de implementación
   - Riesgos y consideraciones

7. **Anexos:**
   - Código fuente
   - Datos completos
   - Análisis detallados

**Tips para presentaciones:**
- Usar visualizaciones claras
- Evitar jerga técnica excesiva
- Enfocarse en decisiones, no en detalles del modelo
- Incluir animaciones si es posible

---

### Etapa 10: Implementación y Seguimiento

**Propósito:** Poner en práctica las recomendaciones y monitorear resultados.

**Actividades:**

1. **Plan de implementación:**
   - Pasos específicos
   - Responsables
   - Cronograma
   - Recursos necesarios

2. **Implementación piloto:**
   - Probar en pequeña escala primero
   - Ajustar según sea necesario

3. **Monitoreo:**
   - Medir métricas reales
   - Comparar con predicciones del modelo
   - Identificar desviaciones

4. **Refinamiento:**
   - Actualizar modelo con nuevos datos
   - Ajustar parámetros
   - Explorar nuevas mejoras

---

## Diagrama Completo de la Metodología

```
┌─────────────────────────────────────────────────┐
│  1. Definición del Problema y Objetivos        │
└──────────────────┬──────────────────────────────┘
                   ↓
┌─────────────────────────────────────────────────┐
│  2. Formulación del Modelo Conceptual          │
└──────────────────┬──────────────────────────────┘
                   ↓
┌─────────────────────────────────────────────────┐
│  3. Recolección y Análisis de Datos            │
└──────────────────┬──────────────────────────────┘
                   ↓
┌─────────────────────────────────────────────────┐
│  4. Implementación del Modelo Computacional    │
└──────────────────┬──────────────────────────────┘
                   ↓
┌─────────────────────────────────────────────────┐
│  5. Verificación del Modelo                    │
│     ¿Código correcto? ──NO──→ Volver a Etapa 4 │
└──────────────────┬──────────────────────────────┘
                   ↓ SÍ
┌─────────────────────────────────────────────────┐
│  6. Validación del Modelo                      │
│     ¿Representa realidad? ──NO──→ Volver a 2/3 │
└──────────────────┬──────────────────────────────┘
                   ↓ SÍ
┌─────────────────────────────────────────────────┐
│  7. Diseño de Experimentos                     │
└──────────────────┬──────────────────────────────┘
                   ↓
┌─────────────────────────────────────────────────┐
│  8. Ejecución y Análisis de Resultados         │
└──────────────────┬──────────────────────────────┘
                   ↓
┌─────────────────────────────────────────────────┐
│  9. Documentación y Presentación               │
└──────────────────┬──────────────────────────────┘
                   ↓
┌─────────────────────────────────────────────────┐
│  10. Implementación y Seguimiento              │
└─────────────────────────────────────────────────┘
```

---

## Errores Comunes en la Metodología

### Error 1: Saltar la Etapa de Definición

❌ **Incorrecto:** Empezar a programar inmediatamente
✅ **Correcto:** Definir claramente objetivos y alcance primero

**Consecuencia:** Modelo que no responde las preguntas correctas

### Error 2: Modelo Demasiado Complejo

❌ **Incorrecto:** Modelar cada detalle del sistema
✅ **Correcto:** Incluir solo lo necesario para los objetivos

**Regla de oro:** "Todo debe ser tan simple como sea posible, pero no más simple" - Einstein

### Error 3: Datos Insuficientes o de Mala Calidad

❌ **Incorrecto:** Usar "estimaciones" sin datos reales
✅ **Correcto:** Recolectar datos suficientes antes de modelar

**Consecuencia:** Modelo no válido, resultados no confiables

### Error 4: No Validar el Modelo

❌ **Incorrecto:** Confiar en resultados sin validación
✅ **Correcto:** Comparar con datos reales, validar con expertos

**Consecuencia:** Decisiones basadas en modelo incorrecto

### Error 5: Pocas Réplicas

❌ **Incorrecto:** Ejecutar 1-5 réplicas
✅ **Correcto:** Mínimo 30 réplicas para intervalos de confianza

**Consecuencia:** Resultados no representativos de la variabilidad

---

## Ejercicios Prácticos

### Ejercicio 1: Diseño de Estudio

**Escenario:** Una cafetería quiere reducir tiempos de espera

**Tareas:**
1. Defina 3 objetivos SMART
2. Identifique las fronteras del sistema
3. Liste los datos que necesitaría recolectar
4. Proponga 3 escenarios a evaluar

### Ejercicio 2: Análisis de Datos

Dado el siguiente conjunto de tiempos de servicio (minutos):
`[3.2, 4.1, 2.8, 5.3, 3.9, 4.5, 3.1, 4.8, 3.7, 4.2]`

1. Calcule media y desviación estándar
2. ¿Qué distribución recomendaría?
3. ¿Son suficientes estos datos? Justifique

### Ejercicio 3: Validación

Un modelo predice tiempo promedio de espera de 8.5 minutos.
Datos reales muestran 9.2 minutos.

1. ¿El modelo es válido?
2. ¿Qué prueba estadística usaría?
3. ¿Qué haría si la diferencia es significativa?

---

## Recursos Adicionales

### Herramientas de Software:
- **Arena:** Software comercial líder
- **SimPy:** Librería Python gratuita
- **AnyLogic:** Multiparadigma
- **Simul8:** Fácil de aprender

### Lecturas Recomendadas:
1. Law & Kelton (1991) - Capítulo 5: "Modeling"
2. Banks et al. (2010) - Capítulo 3: "General Principles"
3. Robinson (2003) - "Conceptual Modeling for Simulation"

---

## Resumen de Conceptos Clave

| Etapa | Pregunta Clave | Entregable |
|-------|----------------|------------|
| 1. Definición | ¿Qué queremos lograr? | Objetivos SMART |
| 2. Modelo Conceptual | ¿Cómo funciona el sistema? | Diagrama de flujo |
| 3. Datos | ¿Qué alimenta el modelo? | Distribuciones ajustadas |
| 4. Implementación | ¿Cómo lo programamos? | Código ejecutable |
| 5. Verificación | ¿El código es correcto? | Pruebas pasadas |
| 6. Validación | ¿Representa la realidad? | Comparación estadística |
| 7. Experimentos | ¿Qué escenarios probar? | Matriz de experimentos |
| 8. Análisis | ¿Qué aprendimos? | Tablas y gráficos |
| 9. Documentación | ¿Cómo comunicamos? | Reporte final |
| 10. Implementación | ¿Cómo lo aplicamos? | Plan de acción |

**Conclusión:** Seguir una metodología rigurosa es la diferencia entre un estudio de simulación exitoso y uno que desperdicia tiempo y recursos.

---

*Referencia: Programa SCD-1022 - TecNM*  
*Fuentes: Law & Kelton (1991), Banks et al. (2010), Robinson (2003)*


---

<div align="center">

⬅️ [1.2 Áreas de Aplicación](1.2.md) &nbsp;&nbsp;|&nbsp;&nbsp; [1.4 Fases del Estudio](1.4.md) ➡️

</div>
